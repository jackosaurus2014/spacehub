generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                String              @id @default(cuid())
  email             String              @unique
  password          String
  name              String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  modulePreferences UserModulePreference[]
}

model NewsArticle {
  id          String   @id @default(cuid())
  title       String
  summary     String?
  content     String?
  url         String   @unique
  source      String
  category    String
  imageUrl    String?
  publishedAt DateTime
  fetchedAt   DateTime @default(now())

  @@index([category])
  @@index([publishedAt])
  @@index([source])
}

model Category {
  id          String @id @default(cuid())
  name        String @unique
  slug        String @unique
  description String?
}

model SpaceEvent {
  id            String   @id @default(cuid())
  externalId    String?  @unique
  name          String
  description   String?
  type          String   // launch, moon_mission, mars_mission, rover, payload, orbital_hab, space_station
  status        String   // upcoming, in_progress, completed, scrubbed, tbd
  launchDate    DateTime?
  launchDatePrecision String? // exact, hour, day, month, quarter, year
  windowStart   DateTime?
  windowEnd     DateTime?
  location      String?
  country       String?
  agency        String?
  rocket        String?
  mission       String?
  imageUrl      String?
  infoUrl       String?
  videoUrl      String?
  fetchedAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([type])
  @@index([status])
  @@index([launchDate])
  @@index([country])
}

model UserModulePreference {
  id         String  @id @default(cuid())
  userId     String
  moduleId   String  // e.g., "mission-control", "news-feed", etc.
  enabled    Boolean @default(true)
  position   Int     @default(0)
  settings   String? // JSON string for module-specific settings
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, moduleId])
  @@index([userId])
}

model ModuleDefinition {
  id          String  @id @default(cuid())
  moduleId    String  @unique
  name        String
  description String?
  icon        String?
  defaultEnabled Boolean @default(true)
  defaultPosition Int @default(0)
}

model BlogSource {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  url         String
  feedUrl     String?    // RSS feed URL if available
  type        String     // blog, newsletter, medium, substack, linkedin
  authorName  String?
  authorTitle String?    // e.g., "Space Law Attorney", "Aerospace Consultant"
  authorType  String     // consultant, lawyer, entrepreneur, investor, engineer, journalist
  description String?
  imageUrl    String?
  isActive    Boolean    @default(true)
  lastFetched DateTime?
  createdAt   DateTime   @default(now())
  posts       BlogPost[]

  @@index([type])
  @@index([authorType])
  @@index([isActive])
}

model BlogPost {
  id          String     @id @default(cuid())
  title       String
  excerpt     String?
  content     String?
  url         String     @unique
  sourceId    String
  source      BlogSource @relation(fields: [sourceId], references: [id], onDelete: Cascade)
  authorName  String?
  imageUrl    String?
  tags        String?    // JSON array of tags
  topic       String?    // space_law, investment, policy, technology, business, exploration
  publishedAt DateTime
  fetchedAt   DateTime   @default(now())

  @@index([sourceId])
  @@index([publishedAt])
  @@index([topic])
}

model SpaceCompany {
  id              String   @id @default(cuid())
  slug            String   @unique
  name            String
  description     String?
  country         String   // USA, CHN, RUS, JPN, etc.
  headquarters    String?
  founded         Int?     // Year founded
  website         String?
  logoUrl         String?

  // Public company info
  isPublic        Boolean  @default(false)
  ticker          String?
  exchange        String?  // NYSE, NASDAQ, TSE, SSE, etc.
  marketCap       Float?   // In billions USD
  stockPrice      Float?
  priceChange24h  Float?   // Percentage

  // Private company info
  isPreIPO        Boolean  @default(false)
  expectedIPODate String?  // e.g., "2025", "Q2 2026", "TBD"
  lastFundingRound String? // e.g., "Series D", "Series B"
  lastFundingAmount Float? // In millions USD
  lastFundingDate  String?
  totalFunding    Float?   // In millions USD
  nextFundingRound String? // Expected next round
  valuation       Float?   // In billions USD (for private companies)

  // Space industry focus
  focusAreas      String   // JSON array: ["launch_provider", "satellites", "space_stations", etc.]
  subSectors      String?  // JSON array of more specific sectors

  // Metadata
  employeeCount   Int?
  revenueEstimate Float?   // In millions USD

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([country])
  @@index([isPublic])
  @@index([ticker])
}

model SpaceResource {
  id              String   @id @default(cuid())
  slug            String   @unique
  name            String
  description     String?
  category        String   // raw_material, composite, component, fuel, life_support, electronics, exotic

  // Earth pricing
  earthPricePerKg Float    // USD per kg on Earth
  priceUnit       String?  // Optional unit clarification (e.g., "per kg", "per liter", "per unit")
  priceSource     String?  // Source of pricing data

  // Properties
  density         Float?   // kg per cubic meter (for volume calculations)

  // Space applications
  applications    String   // JSON array of space applications
  usedIn          String?  // JSON array of systems/missions that use this

  // Supply chain info
  primarySuppliers String? // JSON array of major suppliers/countries
  availability    String?  // abundant, common, limited, rare, critical

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([category])
  @@index([availability])
}

model LaunchProvider {
  id              String   @id @default(cuid())
  slug            String   @unique
  name            String
  vehicle         String   // Rocket/vehicle name
  costPerKgToLEO  Float    // USD per kg to Low Earth Orbit
  costPerKgToGEO  Float?   // USD per kg to Geostationary Orbit
  costPerKgToMoon Float?   // USD per kg to lunar orbit/surface
  costPerKgToMars Float?   // USD per kg to Mars
  payloadToLEO    Float?   // Max payload to LEO in kg
  status          String   // operational, development, retired
  country         String
  reusable        Boolean  @default(false)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([status])
  @@index([country])
}

model BusinessOpportunity {
  id              String   @id @default(cuid())
  slug            String   @unique
  title           String
  description     String
  fullAnalysis    String?  // Detailed AI analysis

  // Classification
  type            String   // government_contract, industry_need, resource_shortage, service_gap, ai_insight, market_trend
  category        String   // launch_services, hardware, satellites, software, logistics, manufacturing, research, consulting, other
  sector          String?  // defense, commercial, civil, scientific

  // Opportunity details
  estimatedValue  String?  // Could be a range like "$1M-$5M" or "Unknown"
  timeframe       String?  // immediate, short_term, medium_term, long_term
  difficulty      String?  // low, medium, high, expert

  // Source information
  sourceType      String   // sam_gov, news_analysis, company_report, ai_generated, user_submitted
  sourceUrl       String?
  sourceName      String?

  // Government contract specific
  solicitationId  String?  @unique
  agency          String?
  dueDate         DateTime?
  contractType    String?  // fixed_price, cost_plus, idiq, etc.
  setAside        String?  // small_business, 8a, hubzone, etc.

  // AI analysis metadata
  aiConfidence    Float?   // 0-1 confidence score
  aiReasoning     String?  // Why AI thinks this is an opportunity
  relatedTrends   String?  // JSON array of related trends
  targetAudience  String?  // JSON array: entrepreneurs, investors, students, corporations

  // Status
  status          String   @default("active") // active, expired, archived, flagged
  featured        Boolean  @default(false)
  viewCount       Int      @default(0)

  // Timestamps
  discoveredAt    DateTime @default(now())
  publishedAt     DateTime?
  expiresAt       DateTime?
  updatedAt       DateTime @updatedAt

  @@index([type])
  @@index([category])
  @@index([status])
  @@index([discoveredAt])
  @@index([featured])
}

model AIAnalysisRun {
  id              String   @id @default(cuid())
  runType         String   // daily_scan, deep_dive, contract_analysis, trend_analysis
  status          String   // pending, running, completed, failed

  // Analysis parameters
  focusAreas      String?  // JSON array of focus areas
  newsSourcesUsed String?  // JSON array of news sources analyzed

  // Results
  opportunitiesFound Int   @default(0)
  insightsGenerated  Int   @default(0)
  summaryReport   String?  // Overall findings summary

  // Metadata
  tokensUsed      Int?
  processingTime  Int?     // in seconds
  errorMessage    String?

  startedAt       DateTime @default(now())
  completedAt     DateTime?

  @@index([runType])
  @@index([status])
  @@index([startedAt])
}
